name: UChicago Runner Jobs

on:
  workflow_dispatch:
  push:

jobs:

  rucio:
    runs-on: arc-runner-set-uchicago

    steps:
      - name: Start
        run: echo "ðŸš€ Running on UChicago ARC Alma9 runner"

      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Setup Globus credentials
        shell: bash
        run: |
          mkdir -p ~/.globus

          # certificate
          cat > ~/.globus/usercert.pem << 'EOF'
          ${{ secrets.VOMS_USERCERT }}
          EOF

          # private key
          cat > ~/.globus/userkey.pem << 'EOF'
          ${{ secrets.VOMS_USERKEY }}
          EOF

          chmod 644 ~/.globus/usercert.pem
          chmod 600 ~/.globus/userkey.pem

          echo "ðŸ“ Globus credentials written:"
          ls -l ~/.globus

      - name: Debug environment
        shell: bash
        run: |
          echo "ðŸ”Ž Checking environment"
          pwd
          ls -R .
          printenv | sort | grep -E 'HOME|SHELL|PATH|RUNNER'
          which bash || true
          which sh || true

      - name: Run Rucio script
        shell: bash
        env:
          VOMS_PASSWORD: ${{ secrets.VOMS_PASSWORD }}
        run: |
          chmod +x Rucio/rucio_script.sh
          ./Rucio/rucio_script.sh uchicago

